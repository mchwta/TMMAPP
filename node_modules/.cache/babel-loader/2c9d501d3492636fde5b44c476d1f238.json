{"ast":null,"code":"import _regeneratorRuntime from\"/Users/toy/Documents/APIU University Work/3rd Year/Mobile Dev/code/ionicproject1/DailyMoments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/toy/Documents/APIU University Work/3rd Year/Mobile Dev/code/ionicproject1/DailyMoments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/toy/Documents/APIU University Work/3rd Year/Mobile Dev/code/ionicproject1/DailyMoments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{IonContent,IonHeader,IonPage,IonTitle,IonToolbar,IonButtons,IonBackButton,IonInput,IonButton,IonList,IonItem,IonTextarea,IonDatetime,IonLabel}from'@ionic/react';import React,{useEffect,useRef,useState}from'react';import{useAuth}from'../auth';import{firestore,store}from'../firebase';import{isPlatform,getPlatforms}from'@ionic/react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";console.log(isPlatform('ios'));// returns true when running on a iOS device\nconsole.log(getPlatforms());// returns [\"iphone\", \"ios\", \"mobile\", \"mobileweb\"] from an iPhone\nvar AddEntryPage=function AddEntryPage(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),date=_useState2[0],setDate=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),title=_useState4[0],setTitle=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),description=_useState6[0],setDescription=_useState6[1];var _useAuth=useAuth(),userId=_useAuth.userId;var _useState7=useState('/assets/placeholder.png'),_useState8=_slicedToArray(_useState7,2),pictureUrl=_useState8[0],setPictureUrl=_useState8[1];var fileInputRef=useRef();// const history = useHistory();\nfunction savePicture(_x,_x2){return _savePicture.apply(this,arguments);}function _savePicture(){_savePicture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(blobUrl,userId){var pictureRef,response,blob,snapshot,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:pictureRef=store.ref(\"/users/\".concat(userId,\"/pictures/\").concat(Date.now()));_context2.next=3;return fetch(blobUrl);case 3:response=_context2.sent;_context2.next=6;return response.blob();case 6:blob=_context2.sent;_context2.next=9;return pictureRef.put(blob);case 9:snapshot=_context2.sent;_context2.next=12;return snapshot.ref.getDownloadURL();case 12:url=_context2.sent;return _context2.abrupt(\"return\",url);case 14:case\"end\":return _context2.stop();}}},_callee2);}));return _savePicture.apply(this,arguments);}useEffect(function(){return function(){if(pictureUrl.startsWith('blob')){URL.revokeObjectURL(pictureUrl);console.log('Revoked',pictureUrl);}};},[pictureUrl]);var handleFileChange=function handleFileChange(event){console.log('Files:',event.target.files);if(event.target.files.length>0){var file=event.target.files.item(0);// get the file\nvar _pictureUrl=URL.createObjectURL(file);// URL object extracted from the file\n// console.log('created: ', pictureUrl);\nsetPictureUrl(_pictureUrl);}};var handleSave=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var entriesRef,entryData,entryRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:entriesRef=firestore.collection(\"users\").doc(userId).collection(\"entries\");entryData={date:date,title:title,pictureUrl:pictureUrl,description:description};if(!pictureUrl.startsWith('blob')){_context.next=6;break;}_context.next=5;return savePicture(pictureUrl,userId);case 5:entryData.pictureUrl=_context.sent;case 6:_context.next=8;return entriesRef.add(entryData);case 8:entryRef=_context.sent;console.log('saved',entryRef.id);// history.goBack();\ncase 10:case\"end\":return _context.stop();}}},_callee);}));return function handleSave(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(IonPage,{children:[/*#__PURE__*/_jsx(IonHeader,{children:/*#__PURE__*/_jsxs(IonToolbar,{children:[/*#__PURE__*/_jsx(IonButtons,{slot:\"start\",children:/*#__PURE__*/_jsx(IonBackButton,{})}),/*#__PURE__*/_jsx(IonTitle,{children:\" Add Entry \"})]})}),/*#__PURE__*/_jsxs(IonContent,{className:\"ion-padding\",children:[/*#__PURE__*/_jsxs(IonList,{children:[/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{position:\"floating\",children:\"Date \"}),/*#__PURE__*/_jsx(IonDatetime,{value:date,onIonChange:function onIonChange(e){return setDate(e.detail.value);}})]}),/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{position:\"floating\",children:\"Title \"}),/*#__PURE__*/_jsx(IonInput,{type:\"text\",value:title,onIonChange:function onIonChange(e){return setTitle(e.detail.value);}})]}),/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{position:\"floating\",children:\"Picture\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",hidden:true,ref:fileInputRef,onChange:handleFileChange}),/*#__PURE__*/_jsx(\"img\",{src:pictureUrl,alt:\"\",style:{cursor:'pointer'},onClick:function onClick(){return fileInputRef.current.click();}})]}),/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{position:\"floating\",children:\"Description \"}),/*#__PURE__*/_jsx(IonTextarea,{value:description,onIonChange:function onIonChange(e){return setDescription(e.detail.value);}})]})]}),/*#__PURE__*/_jsx(IonButton,{expand:\"block\",type:\"submit\",onClick:handleSave,routerLink:\"/my/entries\",children:\" Submit \"})]})]});};export default AddEntryPage;","map":{"version":3,"sources":["/Users/toy/Documents/APIU University Work/3rd Year/Mobile Dev/code/ionicproject1/DailyMoments/src/pages/AddEntryPage.tsx"],"names":["IonContent","IonHeader","IonPage","IonTitle","IonToolbar","IonButtons","IonBackButton","IonInput","IonButton","IonList","IonItem","IonTextarea","IonDatetime","IonLabel","React","useEffect","useRef","useState","useAuth","firestore","store","isPlatform","getPlatforms","console","log","AddEntryPage","date","setDate","title","setTitle","description","setDescription","userId","pictureUrl","setPictureUrl","fileInputRef","savePicture","blobUrl","pictureRef","ref","Date","now","fetch","response","blob","put","snapshot","getDownloadURL","url","startsWith","URL","revokeObjectURL","handleFileChange","event","target","files","length","file","item","createObjectURL","handleSave","entriesRef","collection","doc","entryData","add","entryRef","id","e","detail","value","cursor","current","click"],"mappings":"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","sourcesContent":["import {\n  IonContent,\n  IonHeader,\n  IonPage,\n  IonTitle,\n  IonToolbar,\n  IonButtons,\n  IonBackButton,\n  IonInput,\n  IonButton,\n  IonList,\n  IonItem,\n  IonTextarea,\n  IonDatetime,\n  IonLabel\n} from '@ionic/react';\nimport { Plugins } from '@capacitor/core';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useAuth } from '../auth';\nimport { firestore, store } from '../firebase';\nimport { isPlatform, getPlatforms  } from '@ionic/react';\n\nconsole.log(isPlatform('ios')); // returns true when running on a iOS device\nconsole.log(getPlatforms()); // returns [\"iphone\", \"ios\", \"mobile\", \"mobileweb\"] from an iPhone\n\nconst AddEntryPage: React.FC = () => {\n  const [date, setDate] = useState<string>('');\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const { userId } = useAuth();\n  const [pictureUrl, setPictureUrl] = useState('/assets/placeholder.png');\n  const fileInputRef = useRef<HTMLInputElement>();\n  // const history = useHistory();\n\n  async function savePicture(blobUrl, userId){\n    const pictureRef = store.ref(`/users/${userId}/pictures/${Date.now()}`);\n    const response = await fetch(blobUrl);\n    const blob = await response.blob();\n    const snapshot = await pictureRef.put(blob);\n    const url = await snapshot.ref.getDownloadURL();\n    //console.log(\"Saved:\", url);\n    return url;\n  }\n\n  useEffect(() => () => {\n    if(pictureUrl.startsWith('blob')) {\n      URL.revokeObjectURL(pictureUrl);\n      console.log('Revoked', pictureUrl); \n    }\n  }, [pictureUrl]);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    console.log('Files:', event.target.files);\n    if(event.target.files.length > 0) {\n      const file = event.target.files.item(0);// get the file\n      const pictureUrl = URL.createObjectURL(file); // URL object extracted from the file\n      // console.log('created: ', pictureUrl);\n      setPictureUrl(pictureUrl);\n    }\n  };\n\n  const handleSave = async () => {\n    const entriesRef = firestore.collection(\"users\").doc(userId).collection(\"entries\");\n    const entryData = { date, title, pictureUrl, description };\n    if(pictureUrl.startsWith('blob')) {\n      entryData.pictureUrl = await savePicture(pictureUrl, userId);\n    }\n    const entryRef = await entriesRef.add(entryData);\n    console.log('saved', entryRef.id);\n    // history.goBack();\n  }\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonButtons slot=\"start\">\n            <IonBackButton />\n          </IonButtons>\n          <IonTitle> Add Entry </IonTitle>\n        </IonToolbar>\n      </IonHeader>\n\n      <IonContent className=\"ion-padding\">\n        <IonList>\n          <IonItem>\n            <IonLabel position=\"floating\">Date </IonLabel>\n            <IonDatetime value={date} onIonChange={(e) => setDate(e.detail.value)} />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"floating\">Title </IonLabel>\n            <IonInput type=\"text\" value={title} onIonChange={(e) => setTitle(e.detail.value)} />\n          </IonItem>\n\n          <IonItem>\n            <IonLabel position=\"floating\">Picture</IonLabel><br />\n              <input type=\"file\" accept=\"image/*\" hidden ref={fileInputRef}\n                onChange={handleFileChange} />\n              <img src={pictureUrl} alt=\"\" style={{cursor:'pointer'}}\n                onClick={() => fileInputRef.current.click()} /> \n          </IonItem>\n\n          <IonItem>\n            <IonLabel position=\"floating\">Description </IonLabel>\n            <IonTextarea value={description} onIonChange={(e) => setDescription(e.detail.value)} />\n          </IonItem>\n\n        </IonList>\n\n        <IonButton expand=\"block\" type=\"submit\" onClick={handleSave} routerLink=\"/my/entries\"> Submit </IonButton>\n\n      </IonContent>\n    </IonPage >\n  );\n};\n\nexport default AddEntryPage;\n"]},"metadata":{},"sourceType":"module"}