{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { WebPlugin } from './index';\nimport { CameraResultType, CameraDirection, CameraSource } from '../core-plugin-definitions';\nvar CameraPluginWeb = /** @class */function (_super) {\n  __extends(CameraPluginWeb, _super);\n  function CameraPluginWeb() {\n    return _super.call(this, {\n      name: 'Camera',\n      platforms: ['web']\n    }) || this;\n  }\n  CameraPluginWeb.prototype.getPhoto = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n      return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var cameraModal_1, e_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  if (!options.webUseInput) return [3 /*break*/, 1];\n                  this.fileInputExperience(options, resolve);\n                  return [3 /*break*/, 7];\n                case 1:\n                  if (!customElements.get('pwa-camera-modal')) return [3 /*break*/, 6];\n                  cameraModal_1 = document.createElement('pwa-camera-modal');\n                  document.body.appendChild(cameraModal_1);\n                  _a.label = 2;\n                case 2:\n                  _a.trys.push([2, 4,, 5]);\n                  return [4 /*yield*/, cameraModal_1.componentOnReady()];\n                case 3:\n                  _a.sent();\n                  cameraModal_1.addEventListener('onPhoto', function (e) {\n                    return __awaiter(_this, void 0, void 0, function () {\n                      var photo, _a;\n                      return __generator(this, function (_b) {\n                        switch (_b.label) {\n                          case 0:\n                            photo = e.detail;\n                            if (!(photo === null)) return [3 /*break*/, 1];\n                            reject('User cancelled photos app');\n                            return [3 /*break*/, 4];\n                          case 1:\n                            if (!(photo instanceof Error)) return [3 /*break*/, 2];\n                            reject(photo.message);\n                            return [3 /*break*/, 4];\n                          case 2:\n                            _a = resolve;\n                            return [4 /*yield*/, this._getCameraPhoto(photo, options)];\n                          case 3:\n                            _a.apply(void 0, [_b.sent()]);\n                            _b.label = 4;\n                          case 4:\n                            cameraModal_1.dismiss();\n                            document.body.removeChild(cameraModal_1);\n                            return [2 /*return*/];\n                        }\n                      });\n                    });\n                  });\n\n                  cameraModal_1.present();\n                  return [3 /*break*/, 5];\n                case 4:\n                  e_1 = _a.sent();\n                  this.fileInputExperience(options, resolve);\n                  return [3 /*break*/, 5];\n                case 5:\n                  return [3 /*break*/, 7];\n                case 6:\n                  console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                  this.fileInputExperience(options, resolve);\n                  _a.label = 7;\n                case 7:\n                  return [2 /*return*/];\n              }\n            });\n          });\n        })];\n      });\n    });\n  };\n\n  CameraPluginWeb.prototype.fileInputExperience = function (options, resolve) {\n    var input = document.querySelector('#_capacitor-camera-input');\n    var cleanup = function cleanup() {\n      input.parentNode && input.parentNode.removeChild(input);\n    };\n    if (!input) {\n      input = document.createElement('input');\n      input.id = '_capacitor-camera-input';\n      input.type = 'file';\n      document.body.appendChild(input);\n    }\n    input.accept = 'image/*';\n    input.capture = true;\n    if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n      input.removeAttribute('capture');\n    } else if (options.direction === CameraDirection.Front) {\n      input.capture = 'user';\n    } else if (options.direction === CameraDirection.Rear) {\n      input.capture = 'environment';\n    }\n    input.addEventListener('change', function (_e) {\n      var file = input.files[0];\n      var format = 'jpeg';\n      if (file.type === 'image/png') {\n        format = 'png';\n      } else if (file.type === 'image/gif') {\n        format = 'gif';\n      }\n      if (options.resultType === CameraResultType.DataUrl || options.resultType === CameraResultType.Base64) {\n        var reader_1 = new FileReader();\n        reader_1.addEventListener('load', function () {\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: reader_1.result,\n              format: format\n            });\n          } else if (options.resultType === CameraResultType.Base64) {\n            var b64 = reader_1.result.split(',')[1];\n            resolve({\n              base64String: b64,\n              format: format\n            });\n          }\n          cleanup();\n        });\n        reader_1.readAsDataURL(file);\n      } else {\n        resolve({\n          webPath: URL.createObjectURL(file),\n          format: format\n        });\n        cleanup();\n      }\n    });\n    input.click();\n  };\n  CameraPluginWeb.prototype._getCameraPhoto = function (photo, options) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n      var format = photo.type.split('/')[1];\n      if (options.resultType === CameraResultType.Uri) {\n        resolve({\n          webPath: URL.createObjectURL(photo),\n          format: format\n        });\n      } else {\n        reader.readAsDataURL(photo);\n        reader.onloadend = function () {\n          var r = reader.result;\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: r,\n              format: format\n            });\n          } else {\n            resolve({\n              base64String: r.split(',')[1],\n              format: format\n            });\n          }\n        };\n        reader.onerror = function (e) {\n          reject(e);\n        };\n      }\n    });\n  };\n  return CameraPluginWeb;\n}(WebPlugin);\nexport { CameraPluginWeb };\nvar Camera = new CameraPluginWeb();\nexport { Camera };","map":{"version":3,"names":["WebPlugin","CameraResultType","CameraDirection","CameraSource","CameraPluginWeb","_super","__extends","call","name","platforms","prototype","getPhoto","options","Promise","resolve","reject","__awaiter","_this","webUseInput","fileInputExperience","customElements","get","cameraModal_1","document","createElement","body","appendChild","componentOnReady","_a","sent","addEventListener","e","photo","detail","Error","message","_getCameraPhoto","apply","_b","dismiss","removeChild","present","console","error","input","querySelector","cleanup","parentNode","id","type","accept","capture","source","Photos","Prompt","removeAttribute","direction","Front","Rear","_e","file","files","format","resultType","DataUrl","Base64","reader_1","FileReader","dataUrl","result","b64","split","base64String","readAsDataURL","webPath","URL","createObjectURL","click","reader","Uri","onloadend","r","onerror","Camera"],"sources":["../../../src/web/camera.ts"],"sourcesContent":[null],"mappings":";AAAA,SAASA,SAAS,QAAQ,SAAS;AAEnC,SAIEC,gBAAgB,EAChBC,eAAe,EACfC,YAAY,QACP,4BAA4B;AAEnC,IAAAC,eAAA,0BAAAC,MAAA;EAAqCC,SAAA,CAAAF,eAAA,EAAAC,MAAA;EACnC,SAAAD,gBAAA;WACEC,MAAA,CAAAE,IAAA,OAAM;MACJC,IAAI,EAAE,QAAQ;MACdC,SAAS,EAAE,CAAC,KAAK;KAClB,CAAC;EACJ;EAEML,eAAA,CAAAM,SAAA,CAAAC,QAAQ,GAAd,UAAeC,OAAsB;;;;QACnC,sBAAO,IAAIC,OAAO,CAAc,UAAOC,OAAO,EAAEC,MAAM;UAAA,OAAAC,SAAA,CAAAC,KAAA;;;;;;uBAChDL,OAAO,CAACM,WAAW,EAAnB;kBACF,IAAI,CAACC,mBAAmB,CAACP,OAAO,EAAEE,OAAO,CAAC;;;uBAEtCM,cAAc,CAACC,GAAG,CAAC,kBAAkB,CAAC,EAAtC;kBACIC,aAAA,GAAmBC,QAAQ,CAACC,aAAa,CAAC,kBAAkB,CAAC;kBACnED,QAAQ,CAACE,IAAI,CAACC,WAAW,CAACJ,aAAW,CAAC;;;;kBAEpC,qBAAMA,aAAW,CAACK,gBAAgB,EAAE;;kBAApCC,EAAA,CAAAC,IAAA,EAAoC;kBACpCP,aAAW,CAACQ,gBAAgB,CAAC,SAAS,EAAE,UAAOC,CAAM;oBAAA,OAAAf,SAAA,CAAAC,KAAA;;;;;4BAC7Ce,KAAK,GAAGD,CAAC,CAACE,MAAM;kCAElBD,KAAK,KAAK,IAAI,GAAd;4BACFjB,MAAM,CAAC,2BAA2B,CAAC;;;kCAC1BiB,KAAK,YAAYE,KAAK,GAAtB;4BACTnB,MAAM,CAACiB,KAAK,CAACG,OAAO,CAAC;;;4BAErBP,EAAA,GAAAd,OAAO;4BAAC,qBAAM,IAAI,CAACsB,eAAe,CAACJ,KAAK,EAAEpB,OAAO,CAAC;;4BAAlDgB,EAAA,CAAAS,KAAA,UAAQC,EAAA,CAAAT,IAAA,EAA0C,EAAC;;;4BAGrDP,aAAW,CAACiB,OAAO,EAAE;4BACrBhB,QAAQ,CAACE,IAAI,CAACe,WAAW,CAAClB,aAAW,CAAC;;;;;mBACvC,CAAC;;kBAEFA,aAAW,CAACmB,OAAO,EAAE;;;;kBAErB,IAAI,CAACtB,mBAAmB,CAACP,OAAO,EAAEE,OAAO,CAAC;;;;;kBAG5C4B,OAAO,CAACC,KAAK,CAAC,yGAAyG,CAAC;kBACxH,IAAI,CAACxB,mBAAmB,CAACP,OAAO,EAAEE,OAAO,CAAC;;;;;;;SAG/C,CAAC;;;GACH;;EAEOV,eAAA,CAAAM,SAAA,CAAAS,mBAAmB,GAA3B,UAA4BP,OAAsB,EAAEE,OAAY;IAC9D,IAAI8B,KAAK,GAAGrB,QAAQ,CAACsB,aAAa,CAAC,0BAA0B,CAAqB;IAElF,IAAMC,OAAO,GAAG,SAAVA,OAAOA,CAAA,EAAG;MACdF,KAAK,CAACG,UAAU,IAAIH,KAAK,CAACG,UAAU,CAACP,WAAW,CAACI,KAAK,CAAC;IACzD,CAAC;IAED,IAAI,CAACA,KAAK,EAAE;MACVA,KAAK,GAAGrB,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAqB;MAC3DoB,KAAK,CAACI,EAAE,GAAG,yBAAyB;MACpCJ,KAAK,CAACK,IAAI,GAAG,MAAM;MACnB1B,QAAQ,CAACE,IAAI,CAACC,WAAW,CAACkB,KAAK,CAAC;;IAGlCA,KAAK,CAACM,MAAM,GAAG,SAAS;IACvBN,KAAa,CAACO,OAAO,GAAG,IAAI;IAE7B,IAAIvC,OAAO,CAACwC,MAAM,KAAKjD,YAAY,CAACkD,MAAM,IAAIzC,OAAO,CAACwC,MAAM,KAAKjD,YAAY,CAACmD,MAAM,EAAE;MACpFV,KAAK,CAACW,eAAe,CAAC,SAAS,CAAC;KACjC,MAAM,IAAI3C,OAAO,CAAC4C,SAAS,KAAKtD,eAAe,CAACuD,KAAK,EAAE;MACrDb,KAAa,CAACO,OAAO,GAAG,MAAM;KAChC,MAAM,IAAIvC,OAAO,CAAC4C,SAAS,KAAKtD,eAAe,CAACwD,IAAI,EAAE;MACpDd,KAAa,CAACO,OAAO,GAAG,aAAa;;IAGxCP,KAAK,CAACd,gBAAgB,CAAC,QAAQ,EAAE,UAAC6B,EAAO;MACvC,IAAMC,IAAI,GAAGhB,KAAK,CAACiB,KAAK,CAAC,CAAC,CAAC;MAC3B,IAAIC,MAAM,GAAG,MAAM;MAEnB,IAAIF,IAAI,CAACX,IAAI,KAAK,WAAW,EAAE;QAC7Ba,MAAM,GAAG,KAAK;OACf,MAAM,IAAIF,IAAI,CAACX,IAAI,KAAK,WAAW,EAAE;QACpCa,MAAM,GAAG,KAAK;;MAGhB,IAAIlD,OAAO,CAACmD,UAAU,KAAK9D,gBAAgB,CAAC+D,OAAO,IAAIpD,OAAO,CAACmD,UAAU,KAAK9D,gBAAgB,CAACgE,MAAM,EAAE;QACrG,IAAMC,QAAM,GAAG,IAAIC,UAAU,EAAE;QAE/BD,QAAM,CAACpC,gBAAgB,CAAC,MAAM,EAAE;UAC9B,IAAIlB,OAAO,CAACmD,UAAU,KAAK9D,gBAAgB,CAAC+D,OAAO,EAAE;YACnDlD,OAAO,CAAC;cACNsD,OAAO,EAAEF,QAAM,CAACG,MAAM;cACtBP,MAAM,EAAAA;aACQ,CAAC;WAClB,MAAM,IAAIlD,OAAO,CAACmD,UAAU,KAAK9D,gBAAgB,CAACgE,MAAM,EAAE;YACzD,IAAMK,GAAG,GAAIJ,QAAM,CAACG,MAAiB,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACnDzD,OAAO,CAAC;cACN0D,YAAY,EAAEF,GAAG;cACjBR,MAAM,EAAAA;aACQ,CAAC;;UAGnBhB,OAAO,EAAE;QACX,CAAC,CAAC;QAEFoB,QAAM,CAACO,aAAa,CAACb,IAAI,CAAC;OAC3B,MAAM;QACL9C,OAAO,CAAC;UACN4D,OAAO,EAAEC,GAAG,CAACC,eAAe,CAAChB,IAAI,CAAC;UAClCE,MAAM,EAAEA;SACT,CAAC;QACFhB,OAAO,EAAE;;IAEb,CAAC,CAAC;IAEFF,KAAK,CAACiC,KAAK,EAAE;EACf,CAAC;EAEOzE,eAAA,CAAAM,SAAA,CAAA0B,eAAe,GAAvB,UAAwBJ,KAAW,EAAEpB,OAAsB;IACzD,OAAO,IAAIC,OAAO,CAAc,UAACC,OAAO,EAAEC,MAAM;MAC9C,IAAI+D,MAAM,GAAG,IAAIX,UAAU,EAAE;MAC7B,IAAIL,MAAM,GAAG9B,KAAK,CAACiB,IAAI,CAACsB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACrC,IAAI3D,OAAO,CAACmD,UAAU,KAAK9D,gBAAgB,CAAC8E,GAAG,EAAE;QAC/CjE,OAAO,CAAC;UACN4D,OAAO,EAAEC,GAAG,CAACC,eAAe,CAAC5C,KAAK,CAAC;UACnC8B,MAAM,EAAEA;SACT,CAAC;OACH,MAAM;QACLgB,MAAM,CAACL,aAAa,CAACzC,KAAK,CAAC;QAC3B8C,MAAM,CAACE,SAAS,GAAG;UACjB,IAAMC,CAAC,GAAGH,MAAM,CAACT,MAAgB;UACjC,IAAIzD,OAAO,CAACmD,UAAU,KAAK9D,gBAAgB,CAAC+D,OAAO,EAAE;YACnDlD,OAAO,CAAC;cACNsD,OAAO,EAAEa,CAAC;cACVnB,MAAM,EAAEA;aACT,CAAC;WACH,MAAM;YACLhD,OAAO,CAAC;cACN0D,YAAY,EAAES,CAAC,CAACV,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;cAC7BT,MAAM,EAAEA;aACT,CAAC;;QAEN,CAAC;QACDgB,MAAM,CAACI,OAAO,GAAG,UAACnD,CAAC;UACjBhB,MAAM,CAACgB,CAAC,CAAC;QACX,CAAC;;IAEL,CAAC,CAAC;EACJ,CAAC;EACH,OAAA3B,eAAC;AAAD,CAAC,CAhJoCJ,SAAS;;AAkJ9C,IAAMmF,MAAM,GAAG,IAAI/E,eAAe,EAAE;AAEpC,SAAS+E,MAAM"},"metadata":{},"sourceType":"module"}